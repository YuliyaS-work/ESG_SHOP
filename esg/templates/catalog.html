{% extends 'basic.html' %}
{% load static %}

{% block title %}Каталог: электроснабжение, газоснабжение, водоснабжение, канализация — СпецЭлектроБелТорг{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/catalog.css' %}">
<link rel="stylesheet" href="{% static 'css/pagination.css' %}">
{% endblock %}
{% block meta %}
<meta name="description" content="Каталог электротоваров в Логойске — СпецЭлектроБелТорг. Электроснабжение, газоснабжение, водоснабжение и монтаж инженерных систем. Выбирайте товары и услуги онлайн.">
<meta name="keywords" content="электротовары, каталог, электроснабжение, газоснабжение, водоснабжение, канализация, монтаж, Логойск">
<meta name="robots" content="index, follow">
{% endblock %}
{% block content %}
<main class="main-content">

  <!--  ===кнопка Каталог===-->
  <a href="{% url 'catalog' %}" class="catalog-btn">Посмотреть весь каталог</a>

 <!-- === Верхние кнопки разделов === -->
  <div class="catalog-top-buttons">
    {% for rubric in rubrics %}
      <a href="{% url 'subrubrics' rubric.name_translit %}" class="catalog-btn">
        {% if rubric.rubric_name == "Электрика" %}
          <i class="fas fa-bolt"></i>
        {% elif rubric.rubric_name == "Сантехника" %}
          <i class="fas fa-faucet"></i>
        {% elif rubric.rubric_name == "Газификация" %}
          <i class="fas fa-fire"></i>
        {% else %}
          <i class="fas fa-folder"></i>
        {% endif %}
        <span>{{ rubric.rubric_name }}</span>
      </a>
    {% endfor %}
  </div>


  <!-- === Подкатегории === -->
  <section class="subcategories-section" id="subrubric-list">
    <button class="carousel-btn left">&#10094;</button>
    <ul class="subcategories-list">
      {% for rubric in rubrics %}
        {% for subrubric in rubric.electro_set.all %}
          <li><a href="{% url 'products' rubric.name_translit subrubric.title_translit %}">{{ subrubric.title }}</a></li>
        {% endfor %}
        {% for subrubric in rubric.santeh_set.all %}
          <li><a href="{% url 'products' rubric.name_translit subrubric.title_translit %}">{{ subrubric.title }}</a></li>
        {% endfor %}
        {% for subrubric in rubric.gas_set.all %}
          <li><a href="{% url 'products' rubric.name_translit subrubric.title_translit %}">{{ subrubric.title }}</a></li>
        {% endfor %}
      {% endfor %}
    </ul>
     <button class="carousel-btn right">&#10095;</button>
  </section>

  {% include 'includes/breadcrumbs.html' %}

<!--   ===сортировка===    -->
  <form method="get" id="sortForm">
  <input type="hidden" id="sort" name="page" value="{{ request.GET.page }}">
  <label for="sort">Сортировать по:</label>
  <select name="sort" onchange="this.form.submit()">
    <option value="">-- Выберите --</option>
    <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>По возрастанию цены</option>
    <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>По убыванию цены</option>
    <option value="title_asc" {% if request.GET.sort == 'title_asc' %}selected{% endif %}>По алфавиту (А-Я)</option>
    <option value="title_desc" {% if request.GET.sort == 'title_desc' %}selected{% endif %}>По алфавиту (Я-А)</option>
    <option value="popular" {% if request.GET.sort == 'popular' %}selected{% endif %}>По популярности</option>
  </select>
  </form>

  <!-- === Все товары === -->
  <section class="products-section">
  <div class="products-grid">
    {% for product in page_obj %}
      <div class="product-card-catalog">
<!--&lt;!&ndash;        одна строка новая&ndash;&gt;-->
<!--        <div class="product-image-wrap">-->
        {% if product.photo %}
          <img src="{{ product.photo.url }}" alt="{{ product.title }}">
        {% else %}
          <img src="{% static 'image/default-product.png' %}" alt="Нет изображения">
        {% endif %}
<!--&lt;!&ndash;          кнопка и один див&ndash;&gt;-->
<!--        <button class="quick-view-btn"-->
<!--        data-title="{{ product.title }}"-->
<!--        data-price="{% if product.price %}{{ product.price|floatformat:2 }} руб.{% else %}по запросу{% endif %}"-->
<!--        data-code="{{ product.code }}"-->
<!--        data-description="{{ product.description|default:'Нет описания' }}"-->
<!--        data-img="{% if product.photo %}{{ product.photo.url }}{% else %}{% static 'image/default-product.png' %}{% endif %}">-->
<!--  Быстрый просмотр-->
<!--    </button></div>-->

        <!-- ==название товара для генерации карусели просмотренных товаров=== -->
        {% include 'includes/product_card_for_viewed.html' %}

        <p class="price">{{ product.price }} BYN</p>
        <button  type="button" class="basket" data-title="{{ product.title }}" data-price="{{ product.price|floatformat:2 }}">Купить</button>
      </div>
    {% endfor %}
  </div>
  </section>




     <!-- ===Пагинация===-->
    <div class="pagination">
    {% if page_obj.has_other_pages %}
      <nav class="list-pages">
        <ul>
          {# Первая и предыдущая страницы #}
          {% if page_obj.has_previous %}
            <li class="page-num"><a href="?{% querystring page=1 %}"> <<</a></li>
            <li class="page-num"><a href="?{% querystring page=page_obj.previous_page_number %}"> <</a></li>
          {% endif %}

          {# Номера страниц: текущая, соседние #}
          {% for p in page_obj.paginator.page_range %}
            {% if p == page_obj.number %}
              <li class="page-num page-num-selected">
                  <form method="get" action="">
                     <input type="hidden" name="sort" value="{{ request.GET.sort }}">
                  <input type="number"
                  name="page"
                  value="{{ p }}"
                  min="1"
                  max="{{ page_obj.paginator.num_pages }}"
                  onchange="this.form.submit()"
                  class="page-input">
                  </form>
              </li>
            {% elif p >= page_obj.number|add:-1 and p <= page_obj.number|add:1 %}
              <li class="page-num"><a href="?{% querystring page=p %}">{{ p }}</a></li>
            {% endif %}
          {% endfor %}

          {# Следующая и последняя страницы #}
          {% if page_obj.has_next %}
            <li class="page-num"><a href="?{% querystring page=page_obj.next_page_number %}"> ></a></li>
            <li class="page-num"><a href="?{% querystring page=page_obj.paginator.num_pages %}"> >></a></li>
          {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
<!--&lt;!&ndash;  пустая модалка для карточки&ndash;&gt;-->
<!--  <div id="quick-view-overlay"></div>-->
<!--<div id="quick-view-modal">-->
<!--    <button id="quick-view-close" class="close-btn">&times;</button>-->
<!--    <div class="quick-view-content">-->
<!--        <div class="quick-image">-->
<!--            <img id="qv-img" src="" alt="">-->
<!--        </div>-->
<!--        <div class="quick-info">-->
<!--            <h3 id="qv-title"></h3>-->
<!--            <p><b>Цена:</b> <span id="qv-price"></span></p>-->
<!--            <p><b>Код:</b> <span id="qv-code"></span></p>-->
<!--            <p id="qv-desc"></p>-->
<!--            <button class="basket" id="qv-buy">Купить</button>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
</main>
{% endblock %}
{% block scripts %}
<script src="{% static 'js/catalog.js' %}" defer></script>
<script src="{% static 'js/viewed.js' %}" defer></script>
<!--&lt;!&ndash;скрипт для модалки карточки&ndash;&gt;-->
<!--<script>document.querySelectorAll('.quick-view-btn').forEach(btn => {-->
<!--    btn.addEventListener('click', () => {-->
<!--        document.getElementById('qv-img').src = btn.dataset.img;-->
<!--        document.getElementById('qv-title').innerText = btn.dataset.title;-->
<!--        document.getElementById('qv-price').innerText = btn.dataset.price;-->
<!--        document.getElementById('qv-code').innerText = btn.dataset.code;-->
<!--        document.getElementById('qv-desc').innerText = btn.dataset.description;-->

<!--        document.getElementById('quick-view-modal').classList.add('active');-->
<!--        document.getElementById('quick-view-overlay').classList.add('active');-->
<!--    });-->
<!--});-->

<!--document.getElementById('quick-view-close').onclick =-->
<!--document.getElementById('quick-view-overlay').onclick = () => {-->
<!--    document.getElementById('quick-view-modal').classList.remove('active');-->
<!--    document.getElementById('quick-view-overlay').classList.remove('active');-->
<!--};</script>-->
{% endblock %}
